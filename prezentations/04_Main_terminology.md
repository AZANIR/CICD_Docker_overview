Dockerfile

Dockerfile
Dockerfile – це текстовий файл, який містить всі команди, необхідні для збирання образу Docker. Кожен рядок у Dockerfile є командою, яку Docker використовує під час створення образу. Ось основні аспекти використання Dockerfile та декілька прикладів:

Вказівка базового образу (FROM): Ця команда визначає базовий образ, від якого буде створюватися ваш образ. Наприклад, FROM ubuntu:20.04 вказує на створення образу на базі Ubuntu 20.04.
Встановлення змінних середовища (ENV): Команда ENV встановлює змінні середовища в образі. Наприклад, ENV MY_VARIABLE my_value встановлює змінну середовища MY_VARIABLE.
Запуск команд (RUN): RUN виконує команди в новому шарі образу та виводить результати. Це часто використовується для встановлення пакетів. Наприклад, RUN npm install.
Копіювання файлів та директорій (COPY та ADD): COPY і ADD використовуються для копіювання файлів і директорій з локальної системи до файлової системи образу. COPY є більш простою і прямою командою, в той час як ADD має додаткові можливості, такі як розпакування архівів.
Вказівка портів (EXPOSE): EXPOSE інформує Docker, що контейнер слухає певні порти під час запуску. Наприклад, EXPOSE 80 вказує, що контейнер буде слухати порт 80.
Запуск команди під час запуску контейнера (CMD та ENTRYPOINT): CMD визначає команду, що виконується за замовчуванням, коли контейнер запускається. ENTRYPOINT конфігурує контейнер для запуску як виконуваного файлу.

Приклад Dockerfile:


# Використання базового образу Ubuntu
FROM ubuntu:20.04

# створення папки
RUN mkdir -p app

# Встановлення змінних середовища
ENV APP_HOME /app

# Копіювання файлів проекту
COPY . .

#видалення файлів які не потрібні в контейнері
RUN rm package-lock.json && rm -rf node_modules

# Вказівка робочої директорії
WORKDIR app

# Встановлення необхідних пакетів in package.json
RUN npm install

# Відкриття порту 8080
EXPOSE 8080

# Виконання Node.js скрипта
CMD [ "npm", "start" ]

Цей Dockerfile створює образ на базі Ubuntu 20.04, встановлює node та необхідні залежності, копіює файли проекту у контейнер, відкриває порт 8080 і запускає скрипт.

Dockerfile дозволяє інженерам з автоматизації створити контейнер, який містить усі необхідні залежності та бібліотеки, необхідні для запуску тестів. Це означає, що інженери з автоматизації можуть створити універсальне середовище для всіх машин і уникнути проблем із залежностями, які можуть спричинити помилку тестів на одній системі, але не на іншій.

Docker Image
Image — образ, який створюється на підставі Dockerfile. Також образи можна завантажувати і запускати з віддаленого сховища. Немає необхідності образ Ubuntu збирати самостійно. На підставі одного імейджу можна створити кілька контейнерів.

Це може бути наявний імейдж, створений кимось іншим, або новий імейдж, створений вами. По суті, це легкий, автономний і виконуваний пакет, який містить усі залежності, файли конфігурації та код для тестів.

Це шаблон лише для читання, який містить інструкції для створення контейнера Docker. Імеджі Docker зберігаються в реджістрі Docker, наприклад Docker Hub, загальнодоступному сховищі образів Docker.

Щоб створити Docker імедж, використовується Dockerfile у якому описані інструкції зі створення образу. Після конфігурації конфігів в Dockerfile можна використовувати команду docker build для створення Docker імеджу. Потім отриманий імедж можна відправити до реєстру Docker, наприклад Docker Hub, щоб інші могли використовувати його.

build
docker build [OPTIONS] PATH | URL | -
Команда docker build створює імейдж Docker із файлу Docker і «контексту». Контекст білда — це набір файлів, розташованих у вказаному ШЛЯХУ або URL-адресі. Процес збирання може посилатися на будь-який файл у контексті. Наприклад, ваша збірка може використовувати інструкцію COPY для посилання на файл у контексті.

Параметр URL-адреси може посилатися на три типи ресурсів: сховища Git, попередньо запаковані контексти архівів і файли простого тексту.

URL-адреси Git приймають конфігурацію контексту у своєму розділі фрагментів, розділених двокрапкою (:). Перша частина представляє посилання, яке Git перевірить, і може бути гілкою, тегом або посиланням. Друга частина представляє підкаталог всередині репозиторію, який використовуватиметься як контекст збірки.

Наприклад, виконайте цю команду, щоб використовувати папку під назвою docker у контейнері гілки:

docker build <https://github.com/docker/rootfs.git#container:docker>
image
команда яка дозволяє переглянути усі імейджі на машині

docker images

REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE
<none>                    <none>              77af4d6b9913        19 hours ago        1.089 GB
committ                   latest              b6fa739cedf5        19 hours ago        1.089 GB
<none>                    <none>              78a85c484f71        19 hours ago        1.089 GB
docker                    latest              30557a29d5ab        20 hours ago        1.089 GB
<none>                    <none>              5ed6274db6ce        24 hours ago        1.089 GB
postgres                  9                   746b819f315e        4 days ago          213.4 MB
postgres                  9.3                 746b819f315e        4 days ago          213.4 MB
postgres                  9.3.5               746b819f315e        4 days ago          213.4 MB
postgres                  latest              746b819f315e        4 days ago          213.4 MB

запуск за параметром назви імейджу


docker images java

REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
java                8                   308e519aac60        6 days ago          824.5 MB
java                7                   493d82594c15        3 months ago        656.3 MB
java                latest              2711b1d6f3aa        5 months ago        603.9 MB

Якщо передати параметри REPOSITORY, і TAG, буде показано лише імейджі, які відповідають цьому репозиторію та тегу. Щоб знайти всі локальні зображення в репозиторії "java" з тегом "8", можна використовувати такі параметри:


docker images java:8

REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
java                8                   308e519aac60        6 days ago          824.5 MB

якщо нічого не буде підпадати під ці параметри то і результати будуть відсутні


docker images java:0

REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE

Docker Container. Docker Hub. Docker Compose
Docker Container
Контейнер - це стандартизована упаковка програмного забезпечення, яка включає в себе все необхідне для запуску додатка: код, робоче середовище, системні інструменти, системні бібліотеки та налаштування. Контейнер запускається на основі імейджу.Створений контейнер можна запускати і зупиняти. Паралельно можна запустити кілька контейнерів, незалежних і залежних один від одного.

Контейнер Docker — це виконання Docker імейджу. Це закрите середовище, яке об’єднує код і всі його залежності в єдиний портативний пакет. Це легкий і самодостатній об’єкт, який містить усе необхідне для запуску програми/тестів.

На аплікейшн рівні контейнери служать абстракцією, абсолютно не знаючи про операційну систему або файли хоста. Натомість вони використовують середовище, надане Docker Desktop, яке включає базову операційну систему та всі залежності, необхідні для виконання програми.

Контейнери розроблені таким чином, щоб бути легкими, з усіма основними компонентами, необхідними для запуску програми/тестів, усуваючи будь-які залежності від попередньо існуючого програмного забезпечення на головній машині. Кілька контейнерів можуть працювати на одній машині та спільно використовувати ядро операційної системи з іншими контейнерами, кожен із яких працює як ізольований процес у просторі користувача.

Ними легко ділитися під час роботи, і ви можете бути впевнені, що всі, з ким ви ділитеся, отримають той самий контейнер, який працює однаково. Це полегшує тестування програм у різних середовищах.

Тобто це ізольоване середовище від ОС, де можна виконати дії без впливу на ОС.


Docker Hub
Docker Hub — це сервіс, який розробляється і підтримується командою Docker для пошуку та обміну імейджами контейнерів.

Це найбільше у світі сховище імейджів контейнерів із різним складом, включаючи спільноти розробників контейнерів, проекти з відкритим кодом і незалежні постачальники програмного забезпечення (ISV), які створюють і розповсюджують свій код у контейнерах.

Інструкція з створення акаунту
https://docs.docker.com/docker-id/

це коротка інструкція по створенню і налаштуванню доступу до докер хабу.

❗без акаунту неможливо скачати імейдж з докер хабу і використовувати.


Docker Compose
Compose — це інструмент для визначення та запуску багатоконтейнерних програм Docker. За допомогою файлів YAML налаштувується і описується процес роботи Compose. Потім за допомогою однієї команди ви створюєте та запускаєте всі служби з вашої конфігурації.

Compose працює в будь-якому середовищі: прода, дев, тест, тестування, і на усіх відомих CI провайдерах. Він також містить команди для керування всім lifecycle вашої програми:

Запуск, зупинка та відновлення сервісів Перегляд статусу запущених сервісів Робота з логами запущених сервісів


version: '3'
services:
  web:
    image: apache
    build: ./webapp
    container_name: apache
    restart: always
    # we can see the server running at "localhost:8080"
    ports:
      - "8080:80"

  e2e:
    image: cypress
    build: ./e2e
    container_name: cypress
    depends_on:
      - web
    # note: inside e2e container, the network allows accessing
    # "web" host under name "web"
    # so "curl http://web" would return whatever the webserver
    # in the "web" container is cooking
    # see https://docs.docker.com/compose/networking/
    environment:
      - CYPRESS_baseUrl=http://web
    command: npx cypress run
    # mount the host directory e2e/cypress and the file e2e/cypress.config.js as
    # volumes within the container
    # this means that:
    #  1. anything that Cypress writes to these folders (e.g., screenshots,
    #     videos) appears also on the Docker host's filesystem
    #  2. any change that the developer applies to Cypress files on the host
    #     machine immediately takes effect within the e2e container (no docker
    #     rebuild required).
    volumes:
      - ./e2e/cypress:/app/cypress
      - ./e2e/cypress.config.js:/app/cypress.config.js
      