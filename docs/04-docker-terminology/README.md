# Основна термінологія Docker

## Як пов'язані поняття

Логіка роботи з Docker у тестуванні часто така:

1. **Dockerfile** — опис того, як зібрати середовище (образ).
2. **Образ (image)** — результат збірки за цим описом; шаблон «тільки для читання».
3. **Контейнер (container)** — запущений екземпляр образу; тут виконується ваш код і тести.
4. **Docker Hub** — реєстр, звідки можна завантажувати готові образи і пушити свої.
5. **Docker Compose** — спосіб описати і запустити кілька контейнерів разом (наприклад, веб-сервер + тести).

Нижче кожне поняття розкладено з поясненнями для початківців.

---

## Dockerfile

### Що це таке і навіщо

**Dockerfile** — це звичайний текстовий файл без розширення, у якому по рядках записані інструкції для збірки **образу** Docker. Кожен рядок — це команда, яку Docker виконує по черзі під час `docker build`. Dockerfile не запускає контейнер сам по собі; він лише описує, як створити образ, з якого потім будуть створюватися контейнери.

**Навіщо це тестувальнику:** один Dockerfile дозволяє зібрати однакове середовище на будь-якій машині та в CI — однакові версії ОС, Node, залежностей. Це зменшує проблеми типу «у мене працює, на CI — ні».

### Основні інструкції (коротко)

| Інструкція | Призначення |
|------------|-------------|
| **FROM** | Базовий образ, від якого починається збірка (наприклад, `ubuntu:20.04` або `node:20`). |
| **ENV** | Встановлення змінних оточення всередині образу (наприклад, `ENV NODE_ENV=test`). |
| **RUN** | Виконання команди під час збірки (встановлення пакетів, створення каталогів тощо). Кожен `RUN` створює новий шар образу. |
| **COPY / ADD** | Копіювання файлів з хоста в образ. `COPY` — просте копіювання; `ADD` також вміє розпаковувати архіви. Для початку краще використовувати `COPY`. |
| **WORKDIR** | Встановлення робочої директорії для наступних інструкцій і для запуску контейнера. |
| **EXPOSE** | Документує, який порт слухає контейнер (наприклад, `EXPOSE 8080`). Не відкриває порт на хості — це робить `docker run -p`. |
| **CMD / ENTRYPOINT** | Команда, яка виконується при запуску контейнера. `CMD` можна перевизначити параметрами `docker run`; `ENTRYPOINT` задає фіксовану «точку входу». |

Dockerfile дає змогу інженерам з автоматизації описати універсальне середовище для збірки та запуску тестів і уникнути розбіжностей між машинами.

---

## Docker Image (образ)

### Що це таке

**Образ (image)** — це результат виконання інструкцій з Dockerfile: «знімок» файлової системи, залежностей і конфігурації. Образ **тільки для читання**: його не змінюють під час роботи, з нього лише **створюють контейнери**. Один і той самий образ можна використати для запуску багатьох контейнерів.

Образ може бути:

- зібраний вами локально за Dockerfile (`docker build`);
- завантажений з реєстру (наприклад, Docker Hub): `docker pull postgres:15`.

Для тестувальника образ — це готове середовище (ОС + залежності + код), в якому однаково виконуються тести на різних машинах і в CI.

### Де зберігаються образи

Образи зберігаються локально після `docker build` або `docker pull`. Їх також можна пушити в **реєстр** (Docker Hub, GitLab Container Registry тощо), щоб інші могли їх завантажити і використовувати.

---

## Команда docker build

```text
docker build [OPTIONS] PATH | URL | -
```

**Призначення:** зібрати образ з Dockerfile.

- **PATH** — шлях до каталогу, де лежить Dockerfile (за замовчуванням поточний каталог `.`). Усі файли в цьому каталозі (або в підкаталогах) утворюють **контекст збірки**. Інструкції типу `COPY` можуть брати файли лише з контексту; файли поза ним недоступні.
- **URL** — можна вказати Git-репозиторій або архів; Docker завантажить контекст звідти і виконає збірку. Формат Git: `https://github.com/user/repo.git#branch:subfolder`.
- Результат — новий образ з локальним ім'ям і тегом (наприклад, `my-app:latest`).

**Поширена помилка:** виконувати `docker build` з каталогу, де дуже багато зайвих файлів. Вони всі потрапляють у контекст і можуть сповільнити збірку або потрапити в образ через `COPY . .`. Краще тримати Dockerfile у окремому каталозі або використовувати **`.dockerignore`**, щоб виключити непотрібні файли.

---

## Команда docker images

```text
docker images [REPOSITORY[:TAG]]
```

**Призначення:** показати список образів на вашій машині.

Колонки у виводі:

- **REPOSITORY** — ім'я образу (репозиторій).
- **TAG** — тег версії (наприклад, `latest`, `20`, `v1.0`). Разом `REPOSITORY:TAG` однозначно ідентифікують образ.
- **IMAGE ID** — короткий ідентифікатор образу.
- **CREATED** — коли образ було створено.
- **SIZE** — розмір образу.

Приклади: `docker images` — всі образи; `docker images java` — образи з репозиторією `java`; `docker images java:8` — лише образ `java` з тегом `8`.

---

## Docker Container (контейнер)

### Що це таке

**Контейнер** — це **запущений екземпляр образу**. У ньому виконується ваш код і тести. Контейнер ізольований від хост-системи: має власну файлову систему, мережу та процеси. Всередині контейнера програма «бачить» лише те, що є в образі та що змонтовано ззовні (volumes, змінні оточення).

Кілька контейнерів можна запустити з одного образу; вони будуть незалежними (або пов'язаними через мережу/volumes, як у Docker Compose).

**Для тестувальника:** контейнер — це те середовище, в якому реально виконуються автотести (наприклад, Cypress або Playwright). Ви запускаєте контейнер з потрібним образом і передаєте туди код тестів або монтуєте його з хоста.

### Зв'язок з образом

- Образ — шаблон (read-only).
- Контейнер — «живий» екземпляр: його можна запускати, зупиняти, видаляти. Зміни всередині контейнера не зберігаються в образі (якщо не зберегти контейнер у новий образ командою `docker commit`, що рідко потрібно).

---

## Docker Hub

**Docker Hub** — це публічний реєстр образів Docker. Там можна:

- шукати готові образи (бази даних, мови, інструменти);
- завантажувати їх командою `docker pull`;
- пушити свої образи після реєстрації та логіну (`docker login`, `docker push`).

Без облікового запису можна використовувати публічні образи з обмеженнями (наприклад, rate limit); для регулярної роботи та для приватних образів потрібна реєстрація. Інструкція: [Docker ID — документація](https://docs.docker.com/docker-id/).

**Важливо:** без акаунта в деяких випадках неможливо або обмежено завантажувати образи з Docker Hub. Для навчання та роботи з офіційними образами варто створити безкоштовний акаунт.

---

## Docker Compose

### Що це таке

**Docker Compose** — інструмент для опису та запуску **багатоконтейнерних** застосунків. Конфігурація пишеться в файлі **YAML** (зазвичай `docker-compose.yml`). Однією командою (`docker compose up` або `docker-compose up`) можна підняти всі сервіси, мережі та томи, описані у файлі.

Compose підходить для середовищ: dev, test, staging; його підтримують багато CI-провайдерів. У ньому є команди для запуску, зупинки, перегляду логів і статусу сервісів.

### Навіщо тестувальнику

У тестуванні часто потрібно одночасно запустити:

- застосунок, який тестуємо (наприклад, веб-сервер);
- базу даних або інші залежності;
- контейнер з тестами (наприклад, Cypress), який ходить по мережі до веб-сервера.

Compose дозволяє описати це в одному файлі і запускати все однією командою, без ручного `docker run` для кожного сервісу. У реальних проектах замість поля `version: '3'` краще використовувати актуальний формат Compose (Compose V2); для навчання достатньо розуміти структуру `services`, `ports`, `depends_on`, `volumes`, `environment`.

---

## Що запам'ятати

- **Dockerfile** — опис збірки образу; **образ** — read-only шаблон; **контейнер** — запущений екземпляр образу.
- `docker build` збирає образ з Dockerfile та контексту; `docker images` показує локальні образи.
- **Docker Hub** — реєстр для завантаження та публікації образів; для повноцінної роботи потрібен обліковий запис.
- **Docker Compose** — опис і запуск кількох контейнерів разом (застосунок + тести + залежності), зручно для e2e та інтеграційного тестування.

---

## Приклади у цій папці

У підпапці [examples](./examples/) — приклад Dockerfile для Node.js-додатку та фрагмент `docker-compose.yml` (web + e2e) з коментарями.

Повний текст лекції: [prezentations/04_Main_terminology.md](../../prezentations/04_Main_terminology.md).
